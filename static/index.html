<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WatchQueue</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Sora:wght@500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Landing/Join Screen -->
        <div id="landing-screen" class="screen active">
            <div class="landing-background" aria-hidden="true">
                <div class="bg-mesh"></div>
                <div class="bg-grid"></div>
                <div class="bg-noise"></div>
                <div class="bg-orbs">
                    <span class="orb orb-one"></span>
                    <span class="orb orb-two"></span>
                    <span class="orb orb-three"></span>
                    <span class="orb orb-four"></span>
                </div>
            </div>

            <div class="auth-controls">
                <div id="google-signin-btn"></div>
                <button id="logout-btn" class="btn btn-ghost" style="display:none;">Log out</button>
            </div>
            <p id="auth-user-label" class="subtle"></p>

            <div class="landing-container">
                <div class="hero-kicker">Collaborative Movie/Show Selection</div>
                <div class="logo">
                    <span class="logo-icon">‚ñ∂</span>
                    <h1>WatchQueue</h1>
                </div>

                <div class="landing-actions">
                    <div class="action-card" id="create-room-card">
                        <div class="action-icon action-icon-create" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <rect x="4" y="4" width="16" height="16" rx="4"></rect>
                                <path d="M12 8.2V15.8"></path>
                                <path d="M8.2 12H15.8"></path>
                            </svg>
                        </div>
                        <h3>Create Room</h3>
                        <p>Start a new watch party</p>
                    </div>

                    <div class="action-card" id="join-room-card">
                        <div class="action-icon action-icon-join" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none">
                                <path d="M5 12H17"></path>
                                <path d="M13 8L17.6 12L13 16"></path>
                                <path d="M17.6 12H10.5"></path>
                            </svg>
                        </div>
                        <h3>Join Room</h3>
                        <p>Enter with a code</p>
                    </div>
                </div>

                <section class="saved-rooms-section">
                    <div class="saved-rooms-header">
                        <h3>Your Rooms</h3>
                        <div class="saved-rooms-nav">
                            <button id="saved-rooms-prev-btn" class="saved-rooms-nav-btn" type="button" aria-label="Scroll rooms left">‚Üê</button>
                            <button id="saved-rooms-next-btn" class="saved-rooms-nav-btn" type="button" aria-label="Scroll rooms right">‚Üí</button>
                        </div>
                    </div>
                    <div id="saved-rooms-list" class="saved-rooms-list">
                        <p class="subtle">No saved rooms yet</p>
                    </div>
                </section>
            </div>

            <p class="landing-credit">Made with <span class="credit-heart">‚ù§</span> by Irfan</p>
        </div>

        <!-- Create Room Modal -->
        <div id="create-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close">&times;</button>
                <h2>Create a Room</h2>
                <form id="create-room-form">
                    <div class="form-group">
                        <label for="room-name">Room Name</label>
                        <input type="text" id="room-name" placeholder="Friday Movie Night" required>
                    </div>
                    <div class="form-group">
                        <label for="your-name">Your Name</label>
                        <input type="text" id="your-name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>Pick an Avatar</label>
                        <div class="avatar-picker" id="avatar-picker-create">
                            <span class="avatar-option selected" data-avatar="üòÄ">üòÄ</span>
                            <span class="avatar-option" data-avatar="ü¶ä">ü¶ä</span>
                            <span class="avatar-option" data-avatar="üêª">üêª</span>
                            <span class="avatar-option" data-avatar="ü¶ã">ü¶ã</span>
                            <span class="avatar-option" data-avatar="üê∏">üê∏</span>
                            <span class="avatar-option" data-avatar="ü¶Ñ">ü¶Ñ</span>
                            <span class="avatar-option" data-avatar="üêº">üêº</span>
                            <span class="avatar-option" data-avatar="ü¶Å">ü¶Å</span>
                            <span class="avatar-option" data-avatar="üêØ">üêØ</span>
                            <span class="avatar-option" data-avatar="üê®">üê®</span>
                            <span class="avatar-option" data-avatar="üêô">üêô</span>
                            <span class="avatar-option" data-avatar="üêß">üêß</span>
                            <span class="avatar-option" data-avatar="ü¶â">ü¶â</span>
                            <span class="avatar-option" data-avatar="üê∫">üê∫</span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary modal-submit-btn">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <rect x="4" y="4" width="16" height="16" rx="4"></rect>
                            <path d="M12 8.2V15.8"></path>
                            <path d="M8.2 12H15.8"></path>
                        </svg>
                        Create Room
                    </button>
                </form>
            </div>
        </div>

        <!-- Join Room Modal -->
        <div id="join-modal" class="modal">
            <div class="modal-content">
                <button class="modal-close">&times;</button>
                <h2>Join a Room</h2>
                <form id="join-room-form">
                    <div class="form-group">
                        <label for="room-code">Room Code</label>
                        <input type="text" id="room-code" placeholder="ABC123" maxlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="join-name">Your Name</label>
                        <input type="text" id="join-name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label>Pick an Avatar</label>
                        <div class="avatar-picker" id="avatar-picker-join">
                            <span class="avatar-option selected" data-avatar="üòÄ">üòÄ</span>
                            <span class="avatar-option" data-avatar="ü¶ä">ü¶ä</span>
                            <span class="avatar-option" data-avatar="üêª">üêª</span>
                            <span class="avatar-option" data-avatar="ü¶ã">ü¶ã</span>
                            <span class="avatar-option" data-avatar="üê∏">üê∏</span>
                            <span class="avatar-option" data-avatar="ü¶Ñ">ü¶Ñ</span>
                            <span class="avatar-option" data-avatar="üêº">üêº</span>
                            <span class="avatar-option" data-avatar="ü¶Å">ü¶Å</span>
                            <span class="avatar-option" data-avatar="üêØ">üêØ</span>
                            <span class="avatar-option" data-avatar="üê®">üê®</span>
                            <span class="avatar-option" data-avatar="üêô">üêô</span>
                            <span class="avatar-option" data-avatar="üêß">üêß</span>
                            <span class="avatar-option" data-avatar="ü¶â">ü¶â</span>
                            <span class="avatar-option" data-avatar="üê∫">üê∫</span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary modal-submit-btn">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                            <path d="M5 12H17"></path>
                            <path d="M13 8L17.6 12L13 16"></path>
                            <path d="M17.6 12H10.5"></path>
                        </svg>
                        Join Room
                    </button>
                </form>
            </div>
        </div>

        <!-- Join Name Conflict Modal -->
        <div id="name-conflict-modal" class="modal">
            <div class="modal-content modal-content-sm">
                <button class="modal-close" id="name-conflict-close">&times;</button>
                <h3>Name Already Set</h3>
                <p id="name-conflict-text" class="name-conflict-text"></p>
                <div class="name-conflict-actions">
                    <button class="btn btn-primary" id="name-conflict-change-btn">Change Name</button>
                    <button class="btn btn-ghost" id="name-conflict-keep-btn">Keep Old Name</button>
                </div>
            </div>
        </div>

        <!-- Room Screen -->
        <div id="room-screen" class="screen">
            <header class="room-header">
                <div class="room-info">
                    <div class="room-title-row">
                        <h1 id="room-title">Movie Night</h1>
                        <div id="role-badge" class="role-badge"></div>
                    </div>
                    <div class="room-code-display">
                        Code: <span id="display-room-code">ABC123</span>
                        <button class="copy-btn" id="copy-code-btn" title="Copy code">üìã</button>
                    </div>
                </div>
                <div class="room-members" id="room-members">
                    <!-- Members will be inserted here -->
                </div>
                <div class="room-actions">
                    <button class="btn btn-ghost" id="share-admin-btn" style="display: none;">Share Admin</button>
                    <button class="btn btn-danger" id="delete-room-btn" style="display: none;">Delete Room</button>
                    <button class="btn btn-ghost" id="leave-room-btn">Home</button>
                </div>
            </header>

            <main class="room-main">
                <!-- Add Movie Section -->
                <section class="add-movie-section">
                    <div class="movie-search-container">
                        <form id="add-movie-form" class="add-movie-form">
                            <div class="search-input-wrapper">
                                <input type="text" id="movie-title" placeholder="Search for a movie or show..." autocomplete="off" required>
                                <div id="search-results-dropdown" class="search-dropdown"></div>
                            </div>
                            <button type="submit" class="btn btn-primary">Add</button>
                        </form>
                    </div>
                </section>

                <!-- Queue Section -->
                <section class="queue-section">
                    <div class="section-header">
                        <h2>Queue</h2>
                        <div class="queue-filters">
                            <select id="provider-filter">
                                <option value="">All providers</option>
                            </select>
                            <label class="availability-toggle">
                                <input type="checkbox" id="available-only-toggle">
                                Available now
                            </label>
                        </div>
                        <div class="selection-controls">
                            <select id="selection-mode">
                                <option value="weighted_random">Weighted Random</option>
                                <option value="highest_votes">Highest Votes</option>
                                <option value="round_robin">Round Robin</option>
                            </select>
                            <button class="btn btn-accent" id="pick-movie-btn">üé≤ Pick Movie</button>
                        </div>
                    </div>
                    <div id="queue-list" class="queue-list">
                        <!-- Queue items will be inserted here -->
                        <div class="empty-state" id="empty-queue">
                            <span class="empty-icon">üé¨</span>
                            <p>No movies in queue yet</p>
                            <p class="subtle">Add something to get started!</p>
                        </div>
                    </div>
                </section>

                <!-- Wheel Selection Overlay -->
                <div id="wheel-overlay" class="wheel-overlay">
                    <div class="wheel-container">
                        <h2 class="wheel-header" id="wheel-header-text">Spinning the Wheel...</h2>
                        <div class="wheel-stage">
                            <div class="wheel-pointer"></div>
                            <canvas id="wheel-canvas" width="420" height="420"></canvas>
                        </div>
                        <div class="wheel-result" id="wheel-result">
                            <h2>Tonight's Pick</h2>
                            <div class="selected-movie">
                                <div class="selected-poster" id="selected-poster"></div>
                                <div class="selected-info">
                                    <h3 id="selected-title">Movie Title</h3>
                                    <p id="selected-meta"></p>
                                </div>
                            </div>
                            <div class="selection-actions">
                                <a class="btn btn-accent" id="play-now-link" target="_blank" rel="noopener noreferrer" style="display: none;">Play Now</a>
                                <button class="btn btn-primary" id="start-watching-btn">Start Watching</button>
                                <button class="btn btn-ghost" id="close-selection-btn">Back to Queue</button>
                            </div>
                        </div>
                    </div>
                </div>
                <canvas id="confetti-canvas" class="confetti-canvas"></canvas>
            </main>

            <!-- History Tab -->
            <aside class="history-sidebar" id="history-sidebar">
                <div class="sidebar-header">
                    <h3>Watch History</h3>
                    <button class="close-sidebar-btn" id="close-history-btn">&times;</button>
                </div>
                <div id="history-list" class="history-list">
                    <!-- History items will be inserted here -->
                </div>
            </aside>

            <button class="history-toggle" id="history-toggle-btn" title="View History">üìú</button>
        </div>

        <!-- Toast Container -->
        <div id="toast-container"></div>
        <div id="activity-toast-container"></div>
    </div>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="/static/app.js"></script>
</body>
</html>
